#!/bin/bash
# MIDE CLI - Open directories in MIDE editor
# Usage: mide [directory]

# Get the directory to open (default to current directory)
TARGET_DIR="${1:-.}"

# Convert to absolute path
if [ "$TARGET_DIR" = "." ]; then
    TARGET_DIR=$(pwd)
elif [ "$TARGET_DIR" = ".." ]; then
    TARGET_DIR=$(cd .. && pwd)
elif [[ ! "$TARGET_DIR" = /* ]]; then
    # If relative path, make it absolute
    TARGET_DIR="$(cd "$TARGET_DIR" 2>/dev/null && pwd)"
    if [ $? -ne 0 ]; then
        echo "Error: Directory '$1' not found"
        exit 1
    fi
fi

# Check if directory exists
if [ ! -d "$TARGET_DIR" ]; then
    echo "Error: '$TARGET_DIR' is not a valid directory"
    exit 1
fi

# Find the MIDE executable
# Look in development build location first
DEV_EXECUTABLE="$HOME/ProgrammingFiles/Professional/MIDE/src-tauri/target/debug/app"
RELEASE_EXECUTABLE="$HOME/ProgrammingFiles/Professional/MIDE/src-tauri/target/release/app"
INSTALLED_EXECUTABLE="/usr/local/bin/mide-app"

if [ -f "$DEV_EXECUTABLE" ]; then
    EXECUTABLE="$DEV_EXECUTABLE"
elif [ -f "$RELEASE_EXECUTABLE" ]; then
    EXECUTABLE="$RELEASE_EXECUTABLE"
elif [ -f "$INSTALLED_EXECUTABLE" ]; then
    EXECUTABLE="$INSTALLED_EXECUTABLE"
else
    echo "Error: MIDE executable not found. Please build the application first."
    echo "Run: cd ~/ProgrammingFiles/Professional/MIDE && npm run tauri build"
    exit 1
fi

# Launch MIDE with the directory path as argument
"$EXECUTABLE" "$TARGET_DIR" &>/dev/null &
